name = "edge-chat"
compatibility_date = "2025-09-15"

main = "src/api/chat.mjs"
workers_dev = false
preview_urls = false

[placement]
mode = "smart"

[durable_objects]
bindings = [
  { name = "rooms", class_name = "ChatRoom" },
  { name = "limiters", class_name = "RateLimiter" },
  { name = "tinybase", class_name = "TinyBaseStorageDurableObject" },
]

[observability]
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true
persist = true

[[r2_buckets]]
binding = "CHAT_FILES"
bucket_name = "edge-chat-files"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["ChatRoom", "RateLimiter"]
[[migrations]]
tag = "v2"
new_sqlite_classes = ["TinyBaseStorageDurableObject"]

[assets]
directory = "./dist/ui"
binding = "ASSETS"
run_worker_first = true
not_found_handling = "single-page-application"

[build]
command = "npm run ui"
cwd = "."
watch_dir = "src/ui"

[env.prod]
[env.prod.build]
command = "npm run ui:prod"
